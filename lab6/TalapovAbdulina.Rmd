---
title: "Untitled"
author: "Талапов Н./Абдулина Л."


#Задание 1 

Прочитайте файл в переменную. На основе полученных данных создайте новую переменную в которой будут следующие колонки (наблюдения): 'Year', 'P99', 'P99.5' и 'P99.9'; это уровни дохода ,которые входят в 99-й, 99.5-й и 99.9 персентиль дохода. Чему равнялся P99 в 1972? P99.5 в 1942? P99.9 в 1922? Требуется найти эти значения с помощью кода, а не с помощью глаз (для удобства разумно будет переименовать колонки в данных). 

```{r}
wtid<-read.csv('https://raw.githubusercontent.com/SergeyMirvoda/da2016/master/lab6/wtid-report.csv')
wtid.f<-data.frame(Y=wtid$Year,P99=wtid$P99.income.threshold,P99.5=wtid$P99.5.income.threshold,P99.9=wtid$P99.9.income.threshold)
wtid.f$P99[wtid.f$Y==1972]
wtid.f$P99.5[wtid.f$Y==1942]
wtid.f$P99.9[wtid.f$Y==1922]
```

Постройте диаграмму рассеяний всех трёх персентилей относительно времени. Проверьте, чтобы метки осей были корректными и на оси x были годы от 1913 до 2012. 

```{r} 
plot(wtid.f$Y,wtid.f$P99, xlab = 'Year', type="p", ylab = 'Income', xlim=c(1910, 2020), main='Scattering diagram for percentile 99') 
plot(wtid.f$Y,wtid.f$P99.5, xlab = 'Year', type="p", ylab = 'Income', xlim=c(1910, 2020),main='Scattering diagram for percentile 99.5') 
plot(wtid.f$Y,wtid.f$P99.9, xlab = 'Year', type="p", ylab = 'Income', xlim=c(1910, 2020),main='Scattering diagram for percentile 99.9') 
``` 


Из предыдущих вычислений можно получить, что оценить параметр a можно по следующей формуле: a = 1 - log(10)/log(P99/P99.9) (3). Напишите функцию my.exp.estimate_ratio, которая принимает аргументы P99 и P99.9 и возвращает a, рассчитанное по формуле (3). Проверьте, что при P99 = 1e6 и P99.9 = 1e7 функция вернёт a = 2. 

```{r} 
my.exp.estimate_ratio<-function(data,P99,P99.9){ 
return(a = 1 - log(10)/log(P99/P99.9)) 
} 
my.exp.estimate_ratio(wtid.f,10^6,10^7) 
``` 


#Задание 2 
Получите значение a для каждого года в наборе данных. Если функция написана корректно вам не понадобятся циклы. Постройте график а относительно годов. Что можно сказать по полученному графику, соотносится ли это с тем, что имеется на самом деле?(Имейте ввиду, чем экспонента меньше, тем выше неравенство) 

```{r} 
vecA<-data.frame(a=my.exp.estimate_ratio(wtid.f,wtid.f$P99,wtid.f$P99.9)) 
wtid.f$A<-vecA$a 
wtid.f 
plot(wtid.f$Y,wtid.f$A,xlab='Year',ylab='a') 
plot(wtid.f$Y,wtid.f$P99,xlab='Year',ylab='P99') 
plot(wtid.f$Y,wtid.f$P99.9,xlab='Year',ylab='P99.9') 
``` 
Функция a возрастает когда значение отношения функций P99 от Y к P99.9 от Y возрастает. На 2 и 3 графике видно, что функция P.99 от Y значительно возрастает на протяжении всего периода, когда как функция P99.9 от Y значительно возрастает под конец периода. 


Используя полученную для 2012 года оценку параметра a проверьте выполняется ли принцип Парето (20% популяции владеет 80 % богатства) однако зависит от конкретной величины k). 

```{r} 
a2012<-wtid.f$A[wtid.f$Y==2012] 
fsf<-((a2012-1)/wtid.f$P99.9[wtid.f$Y==2012])*(wtid.f$P99.9[wtid.f$Y==2012]*0.8*wtid.f$P99.9[wtid.f$Y==2012]) 
``` 
Принцип Паретто выполняется 


Из выражения (3) можно вывести следующее: (P99.5/P99.9)^(-a+1) = 5. Напишите функцию, которая будет принимать P99.5, P99.9 и a , и вычислять левую часть выражения. Отобразите полученное на графике. На нём же отобразите горизонтальную прямую с вертикальной координатой равной 5 (при помощи команды abline). Насколько качественно выполнена подгонка модели? 

```{r} 
func1<-function(P99.5,P99.9,a){ 
return((P99.5/P99.9)^(-a+1)) 
} 
plot(wtid.f$Y,func1(wtid.f$P99.5,wtid.f$P99.9,wtid.f$A), xlab='Year',ylab='a', main='P99.5 and P99.9') 
abline(h = 5, col = '232323') 
``` 


Тоже самое верно и для: (P90/P95)^(-a+1) = 2. Повторите предыдущее для этой формулы. Что можно сказать, сравнив эти подгонки? 

```{r} 
plot(wtid.f$Y, func1(wtid$P90.income.threshold,wtid$P95.income.threshold,vecA$a), xlab='Year',ylab='a', main='P90 and P95') 
abline(h = 2, col = "232323") 
``` 


Для P90 и P95 значения в основном